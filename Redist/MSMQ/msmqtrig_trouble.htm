<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<HTML DIR="LTR">
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Troubleshooting MSMQ Triggers</TITLE>

</HEAD>

<BODY>

<P><A HREF="msmqtrig.htm" TITLE="MSMQ Triggers">MSMQ Triggers Topics</A> | <A HREF="msmqtrig_using.htm" TITLE="Using MSMQ Triggers">Previous</A> | <A HREF="msmqtrig_examples.htm" TITLE="MSMQ Triggers Example">Next</A></P>

<H2>Troubleshooting MSMQ Triggers</H2>

<HR>

<P>This section discusses the most common problems encountered when using MSMQ Triggers and describes how to use MSMQ Trigger Monitor, a troubleshooting tool used for capturing and displaying trace and diagnostic information generated by the MSMQ Triggers Service.</P>

<H3>Common Problems</H3>

<P>This topic describes the most common problems and their causes when using MSMQ Triggers.</P>

<P><B>The MSMQ Triggers Service fails to start</B>.</P>

<P>Probable causes include the following:</P>

<UL>
<LI>The MSMQ Triggers service has been configured to run under a domain user account without proper administrative permissions. Note that the default LocalSystem account has sufficient permissions to run the MSMQ Triggers service.</LI> 
<LI>The computer has been started with a &quot;no network&quot; profile, thus the RPC calls used by Message Queuing are failing. Verify that the computer has network connectivity.</LI>
<LI>The MSMQ Triggers service has crashed. In-process Component Object Model (COM) components that are invoked can sometimes crash and as a result can also crash the MSMQ Triggers Service. This service should not be restarted until the condition that causes the COM component to crash has been rectified.</LI>
<LI>The MSMQ Triggers Service is unresponsive. This can happen if the invoked action (and associated EXE or COM component) is blocked. This service can commence once the blocked component is able to continue.</LI>
</UL>

<P><B>A trigger is defined but it does not appear to be firing</B>.</P>

<P>Probable causes include the following:</P>

<UL>

<LI>The trigger is currently disabled. Confirm that the trigger has been enabled.</LI>

<LI>The account the MSMQ Trigger Service runs under has not been granted the Peek Message permission for a queue. In this case, you will have to stop and restart this service after changing the permissions for the queue(s).</LI> 

<LI>The MSMQ Trigger Service is not running. Verify that this service has been started.</LI>

<LI>The MSMQ Triggers Service has been paused. Verify that this service is not in a paused state.</LI>

<LI>For the first rule created and assigned to the first trigger for a queue, the rule is activated on messages that are already contained in the queue, instead of on messages that arrive in the queue subsequently.</LI>

<LI>The trigger condition is not being met (is false).</LI>

</UL>

<P><B>The warning &quot;The message &quot;CreateTriggerMonitor() failed to create a new monitor thread as there are already the maximum allowable number of threads in the pool (x)&quot; appears in the Windows event log&quot;</B>.</P>

<P>This message is normal when the MSMQ Triggers Service runs under heavy load. It indicates that the maximum number of threads has been reached. You can ignore this warning, or you can increase the maximum number of allowable threads.</P>

<H3><A NAME="usingtriggermonitor">Using MSMQ Triggers Monitor</A></H3>

<P>MSMQ Trigger Monitor (Trigmon.exe) is a troubleshooting tool that can be used to capture and view detailed trace and diagnostic information produced by the MSMQ Triggers Service. This tool displays messages as they are issued from the service. Using MSMQ Trigger Monitor, it is possible to trace which threads have fired which triggers for which message.</P>

<P>You can run MSMQ Trigger Monitor by double-clicking Trigmon.exe in Windows Explorer (under \Program Files\Microsoft\MSMQ Triggers).</P>

<P>MSMQ Trigger Monitor provides the following features to assist in trigger testing and development.</P>

<UL>

<LI>Displayed trace messages can be exported to a text file. This feature is accessed from the <B>File</B> menu.</LI>

<LI>Selected columns can be displayed or hidden from view. This feature is accessed from the <B>Columns</B> menu.</LI>

<LI>Filtering can be applied to displayed rows. This is done to isolate the history of a particular thread or object for the MSMQ Triggers Service. This feature is accessed from the <B>View</B> menu.</LI>

<LI>Trace messages can be deleted after viewing them, or can be saved for later analysis. This feature is toggled using the <B>Consume Messages</B> check box. Clear this check box if you wish to save trace messages for later analysis. You must first click <B>Open Log Queue</B> to access this check box.</LI>

<LI>MSMQ Trigger Monitor operation can be paused by selecting the <B>Pause Monitor</B> check box.</LI>

<LI>MSMQ Trigger Monitor can produce an audible beep when the MSMQ Trigger Service issues an error or warning message. This feature is disabled by default, and is accessed from the <B>View</B> menu.</LI>

</UL>

<P>Before you can use MSMQ Trigger Monitor, you must first do the following:</p>

<OL>
<LI>Open the Computer Management snap-in.</LI>
<LI>Right-click <B>Triggers</B> and then click <B>Properties</B>. </LI>
<LI>On the <B>Triggers configuration</B> tab, select the <B>write to log queue</B> check box.</LI>
</OL>

<P>For more information about using the Computer Management snap-in, see <A HREF="msmqtrig_using.htm">Using MSMQ Triggers</A>.</P>

</BODY>
</HTML>
